# Import the classes for validating image metadata and XML structure from the respective modules.
from ._data_model_accuracy.data_model_accuracy_img import DataModelAccuracyIMG
from ._data_model_accuracy.data_model_accuracy_xml import DataModelAccuracyXML


def DataModelAccuracy(folder_path_img, folder_path_xml, required_metadata, xml_config):
    """
    Runs the data model accuracy validation on both image files and XML files.

    Parameters:
      folder_path_img: Path to the folder containing image files.
      folder_path_xml: Path to the folder containing XML files.
      required_metadata: List of required metadata keys for image validation.
                         Example: ["width", "height", "format", "location", "date"]
      required_fields: List of required XML fields in hierarchical format for XML validation.
                       Example: ["LicensePlate/RegistrationPrefix", "LicensePlate/SeriesLetter", ...]

    Process:
      1. Create an instance of DataModelAccuracyIMG with the image folder and required metadata.
      2. Validate all images in the folder by checking for missing metadata.
      3. Generate a JSON report for the image accuracy.
      4. Create an instance of DataModelAccuracyXML with the XML folder and required fields.
      5. Validate all XML files in the folder by checking for missing fields.
      6. Generate a JSON report for the XML accuracy.
    """
    # Instantiate the image validator with the image folder and required metadata.
    validator = DataModelAccuracyIMG(folder_path_img, required_metadata)
    # Validate all images in the specified folder.
    validator.validate_images()
    # Generate and store the JSON report for image metadata accuracy.
    report_img = validator.get_model_accuracy()

    # Instantiate the XML validator with the XML folder and required fields.
    required_fields = list(xml_config.values())
    validator = DataModelAccuracyXML(folder_path_xml, required_fields)
    # Validate all XML files in the specified folder.
    validator.validate_files()
    # Generate and store the JSON report for XML structure accuracy.
    report_xml = validator.get_model_accuracy()

    return report_xml  , report_img



# required_metadata = ["width", "height", "format", "location", "date"]
# folder_path_img = "/home/reza/Desktop/data-validation/evaluation_license_plate_data/assets/img"  # Change to your folder path

# required_fields = [
#     "CarData/LicensePlate/RegistrationPrefix",
#     "LicensePlate/SeriesLetter",
#     "LicensePlate/RegistrationNumber",
#     "LicensePlate/ProvinceCode",
#     "CarModel",
#     "CarColor",
#     "LicensePlateCoordinates/X",
#     "LicensePlateCoordinates/Y",
#     "LicensePlateCoordinates/Width",
#     "LicensePlateCoordinates/Height",
#     "CarCoordinates/X",
#     "CarCoordinates/Y",
#     "CarCoordinates/Width",
#     "CarCoordinates/Height"
# ]

# # Specify folder path containing XML files
# folder_path_xml = "/home/reza/Desktop/data-validation/evaluation_license_plate_data/assets/xml"  # Change this to your folder path



# print(DataModelAccuracy(folder_path_img, folder_path_xml, required_metadata, required_fields))


#output 
# ('{\n    "1000423.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000393.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000376.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000396.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000395.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000212.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000229.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000244.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000211.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "1000198.xml": {\n        "fields": {\n            "cardatalicenseplateregistrationprefix_accuracy": 0.0,\n            "licenseplateseriesletter_accuracy": 1.0,\n            "licenseplateregistrationnumber_accuracy": 1.0,\n            "licenseplateprovincecode_accuracy": 1.0,\n            "carmodel_accuracy": 1.0,\n            "carcolor_accuracy": 1.0,\n            "licenseplatecoordinatesx_accuracy": 1.0,\n            "licenseplatecoordinatesy_accuracy": 1.0,\n            "licenseplatecoordinateswidth_accuracy": 1.0,\n            "licenseplatecoordinatesheight_accuracy": 1.0,\n            "carcoordinatesx_accuracy": 1.0,\n            "carcoordinatesy_accuracy": 1.0,\n            "carcoordinateswidth_accuracy": 1.0,\n            "carcoordinatesheight_accuracy": 1.0\n        },\n        "file_accuracy": 0.9285714285714286,\n        "missing_fields": [\n            "CarData/LicensePlate/RegistrationPrefix"\n        ]\n    },\n    "overall_accuracy": 0.9285714285714286\n}', '{\n    "1000423.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000211.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000212.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000395.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000396.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000244.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000229.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000393.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000198.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "1000376.png": {\n        "fields": {\n            "width_accuracy": 1.0,\n            "height_accuracy": 1.0,\n            "format_accuracy": 1.0,\n            "location_accuracy": 0.0,\n            "date_accuracy": 0.0\n        },\n        "file_accuracy": 0.6,\n        "missing_metadata": [\n            "location",\n            "date"\n        ]\n    },\n    "summary": {\n        "overall_accuracy": 0.6\n    }\n}')